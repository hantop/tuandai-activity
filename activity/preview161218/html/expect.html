<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no" />
    <meta name="format-detection" content="telephone=no">
    <title>preview161218</title>
    <!-- build:css(dist) ../css/main.css -->
    <link rel="stylesheet" href="../css/media.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link rel="stylesheet" href="../css/common.css">
    <!-- endbuild -->
    <link rel="stylesheet" href="../css/expect.css">
    <!-- build:js({dist}) ../js/lib/adapt.js -->
    <script src="../js/adapt.js" type="text/javascript" charset="utf-8"></script>
    <!-- endbuild -->
    <script>
        var total_seconds = 24 * 60 * 60 * 1000 * 3;
    </script>
</head>

<body>
    <div class="scroll scroll-active">
        <div class="content">
            <i class="title-heart icon-title-page3"></i>
            <i class="act-time">活动时间：12月18日-12月19日</i>
            <ul class="list" id="present_list">
                <li class="item" data-type="0"><i class="icon-block icon-ticket"></i>
                    <p>投资加息</p>
                </li>
                <li class="item" data-type="1"><i class="icon-block icon-box"></i>
                    <p>开宝箱拿豪礼</p>
                </li>
                <li class="item" data-type="2"><i class="icon-block icon-gold"></i>
                    <p>纪念版金条</p>
                </li>
                <li class="item" data-type="3"><i class="icon-block icon-redpack"></i>
                    <p>超实惠投资红包</p>
                </li>
            </ul>
            <div class="subtitle">
                距离12.18网贷爱心日
            </div>
            <section class="countdown">
                <div class="bloc-time days">
                    <div class="figure days" data-type="day">
                        <div class="tens day0">
                            <span class="next">1</span>
                            <span class="current">2</span>
                            <span class="prev"></span>
                        </div>
                        <div class="unit day1">
                             <span class="next">1</span>
                            <span class="current">2</span>
                            <span class="prev"></span>
                        </div>
                    </div>
                    <span>天</span>
                </div>
                <div class="bloc-time hours">
                    <div class="figure hours" data-type="hour">
                        <div class="tens hour0" data-system="2">
                             <span class="next">2</span>
                            <span class="current">3</span>
                            <span class="prev"></span>
                        </div>
                        <div class="unit hour1">
                             <span class="next">2</span>
                            <span class="current">3</span>
                            <span class="prev"></span>
                        </div>
                    </div>
                    <span>小时</span>
                </div>
                <div class="bloc-time min">
                    <div class="figure min" data-type="min">
                        <div class="tens min0" data-system="6">
                             <span class="next">3</span>
                            <span class="current">4</span>
                            <span class="prev"></span>
                        </div>
                        <div class="unit min1">
                            <span class="next">3</span>
                            <span class="current">4</span>
                            <span class="prev"></span>
                        </div>
                    </div>
                    <span>分</span>
                </div>
                <div class="bloc-time sec">
                    <div class="figure sec" data-type="sec">
                        <div class="tens sec0" data-system="6">
                            <span class="next">5</span>
                            <span class="current">6</span>
                            <span class="prev"></span>
                        </div>
                        <div class="unit sec1">
                            <span class="next">6</span>
                            <span class="current">7</span>
                            <span class="prev"></span>
                        </div>
                    </div>
                    <span>秒</span>
                </div>
            </section>
        </div>
    </div>
    <footer class="footer">
        <a data-type="0">爱心特权</a>
        <a data-type="1">爱心专享</a>
        <a data-type="2">预售专场</a>
        <a class="active" data-type="3">敬请期待</a>
    </footer>
</body>
<!-- build:js({dist}) ../js/lib/fastclick-jquery-1.8.3.js -->
<script src="../js/fastclick-jquery-1.8.3.js" type="text/javascript" charset="utf-8"></script>
<!-- endbuild -->
<script src="../js/Util.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="../js/expect.js" type="text/javascript" charset="utf-8"></script> -->
<script>
    (function() {
    FastClick.attach(document.body);

    //弹窗
    $("#present_list").on("click",".item", function(e) {
        var $target = $(e.currentTarget);
        var _type = $target.attr("data-type"),
            _title = "",
            _icon_class = $target.find(".icon-block")[0].className,
            _message = "";
        switch (_type) {
            case "0" :
            _title = "投资加息";
            _message = "用户获得的加息特权将在活动结束后进行叠加使用，加入预售及正式专场智能理财所匹配的标的将会在活动结束后获得加息奖励。";
            break;
            case "1" :
            _title = "开箱拿壕礼";
            _message = "用户累计加入智能理财（含预售）满5000元、30000元，均可获得1次机会分别打开金银宝箱。宝箱含加息特权、iPhone 7 Plus、60寸电视机、年会邀请等丰富奖品，100%中奖。";
            break;
            case "2" :
            _title = "纪念版金条";
            _message = "活动期间加入智能理财（含预售）金额排名前50的用户均可获得现金红包奖励（最高奖励1万元），排名前10的用户还可额外获得价值万元的金条一份。";
            break;
            case "3" :
            _title = "投资红包";
            _message = "活动期间用户参与宝箱开奖即有机会获得不同面额的投资红包，投资红包的使用杠杆为1:100。";
            break;
        }
          Util.message(_title, '<i class="'+_icon_class+'"></i><p>'+_message+'</p>');

    })

    function getTimeDiff(diff) {
        var ONE_DAY = 1000 * 60 * 60 * 24; //1天的毫秒数
        var ONE_HOUR = 1000 * 60 * 60; // 1小時的毫秒數  
        var ONE_MIN = 1000 * 60; // 1分鐘的毫秒數  
        var ONE_SEC = 1000; // 1秒的毫秒數   


        var leftDays = Math.floor(diff / ONE_DAY);
        if (leftDays > 0) diff = diff - (leftDays * ONE_DAY);

        var leftHours = Math.floor(diff / ONE_HOUR);
        if (leftHours > 0) diff = diff - (leftHours * ONE_HOUR);

        var leftMins = Math.floor(diff / ONE_MIN);
        if (leftMins > 0) diff = diff - (leftMins * ONE_MIN);

        var leftSecs = Math.floor(diff / ONE_SEC);

        var obj = {
            "days": leftDays,
            "hours": leftHours,
            "minutes": leftMins,
            "seconds": leftSecs
        };
        // console.log("兩個時間差距為%d天,%d小時,%d分,%d秒",leftDays,leftHours,leftMins,leftSecs); 
        return obj;

    }

    function getTensAndUnit(value) {
        return [value.toString().charAt(0), value.toString().charAt(1)];
    }
    // 倒计时---------------------
    // Create Countdown
    var Countdown = {

        // Backbone-like structure
        $el: $('.countdown'),

        // Params
        countdown_interval: null,
        total_seconds: 0,

        // Initialize the countdown  
        init: function(ms) {

            // DOM
            this.$ = {
                days: this.$el.find('.figure.days'),
                hours: this.$el.find('.figure.hours'),
                minutes: this.$el.find('.figure.min'),
                seconds: this.$el.find('.figure.sec')
            };

            // Init countdown values
            this.values = {
                hours: 10,
                minutes: 0,
                seconds: 0,
            };

            // Initialize total seconds
            // this.total_seconds = seconds;
            this.values = getTimeDiff(ms);
            // this.total_seconds = this.values.days * 24 * 60 * 60 + this.values.hours * 60 * 60 + (this.values.minutes * 60) + this.values.seconds - 1;
            this.total_seconds = ms / 1000 - 1;
            this.initData(this.values);
            // Animate countdown to the end 
            this.count();
        },
        initData: function(values) {
            setData(values.days, this.$.days);
            setData(values.hours, this.$.hours);
            setData(values.minutes, this.$.minutes);
            setData(values.seconds, this.$.seconds);

            function setData(value, $el) {
                var _type = $el.attr("data-type");
                var _values = value < 10 ? [0, value] : getTensAndUnit(value);
                var _nexts = [];

                switch (_type) {
                    case "day":
                        var _next_ten = Math.floor(value / 10) - 1;
                        _nexts = [_next_ten < 0 ? 9 : _next_ten, (value - 1) % 10];
                        break;
                    case "hour":
                        if (value == 0) {
                            _nexts = [2, 3];
                        } else {
                            var _next_ten = Math.floor(value / 10) - 1;
                            _nexts = [_next_ten < 0 ? 2 : _next_ten, (value - 1) % 10];
                        }
                        break;
                    case "min":
                    case "sec":
                        if (value == 0) {
                            _nexts = [5, 9];
                        } else {
                            var _next_ten = Math.floor(value / 10) - 1;
                            _nexts = [_next_ten < 0 ? 5 : _next_ten, (value - 1) % 10];
                        }

                        break;
                }


                $el.find(".tens .current").html(_values[0]);
                $el.find(".tens .next").html(_nexts[0]);
                $el.find(".unit .current").html(_values[1]);
                $el.find(".unit .next").html(_nexts[1]);
            }

        },
        count: function() {

            var that = this,
                $day_0 = this.$.days.find(".day0"),
                $day_1 = this.$.days.find(".day1"),
                $hour_0 = this.$.hours.find(".hour0"),
                $hour_1 = this.$.hours.find(".hour1"),
                $min_0 = this.$.minutes.find(".min0"),
                $min_1 = this.$.minutes.find(".min1"),
                $sec_0 = this.$.seconds.find(".sec0"),
                $sec_1 = this.$.seconds.find(".sec1");

            this.countdown_interval = setInterval(function() {
                // console.log(that.total_seconds);
                if (that.total_seconds > -1) {

                    --that.values.seconds;

                    if (that.values.minutes >= 0 && that.values.seconds < 0) {

                        that.values.seconds = 59;
                        --that.values.minutes;
                    }

                    if (that.values.hours >= 0 && that.values.minutes < 0) {

                        that.values.minutes = 59;
                        --that.values.hours;
                    }

                    if (that.values.days >= 0 && that.values.hours < 0) {
                        that.values.hours = 23;
                        --that.values.days;
                    }


                    // Update DOM values
                    // Days
                    // that.checkHour(that.values.days, $day_0, $day_1);

                    // // Hours
                    // that.checkHour(that.values.hours, $hour_0, $hour_1);

                    // // Minutes
                    // that.checkHour(that.values.minutes, $min_0, $min_1);

                    // Seconds
                    that.checkSec(that.values.seconds, $sec_0, $sec_1);

                    --that.total_seconds;
                } else {
                    clearInterval(that.countdown_interval);
                }
            }, 1000);
        },
        animateFigure: function($el, value) {
            var that = this,
                $next = $el.find('.next'),
                $current = $el.find('.current'),
                $prev = $el.find('.prev');
            var _type = $el.parent().attr("data-type");
            var system = $el.attr("data-system");
            var _next;

            // console.log(_type, this.values);

            if (_type === "hour") {
                if (system) {
                    if (this.values.hour < 9) {
                        system = 3;
                    } else {
                        system = 9;
                    }
                    _next = value - 1 < 0 ? system : value - 1;

                } else {
                    _next = value - 1 < 0 ? 2 : value - 1;
                }
            } else {
                system = system ? system - 1 : 9;
                _next = value - 1 < 0 ? system : value - 1;
            }

            $next[0].className = "current";
            $current[0].className = "prev";
            $prev[0].className = "next";
            $prev.html(_next);

            // animated
            // (function(el) {
            //     setTimeout(function() {
            //         el.className = "next";
            //     }, 200);
            // })($current[0])
            // setTimeout(function() {
            //     $current[0].className = "next";
            // }, 200);

        },

        checkHour: function(value, $el_0, $el_1) {
            this.checkTime(value, $el_0, $el_1);
            var $day_0 = this.$.days.find(".day0"),
                $day_1 = this.$.days.find(".day1");
            if (this.values.hours == 23) {
                this.checkTime(this.values.days, $day_0, $day_1);
            }
        },
        checkMin: function(value, $el_0, $el_1) {
            this.checkTime(value, $el_0, $el_1);
            var $hour_0 = this.$.hours.find(".hour0"),
                $hour_1 = this.$.hours.find(".hour1");
            if (this.values.minutes == 59) {
                this.checkHour(this.values.hours, $hour_0, $hour_1);
            }
        },
        checkSec: function(value, $el_0, $el_1) {
            this.checkTime(value, $el_0, $el_1);
            var $min_0 = this.$.minutes.find(".min0"),
                $min_1 = this.$.minutes.find(".min1");
            if (this.values.seconds == 59) {
                this.checkMin(this.values.minutes, $min_0, $min_1);
            }
        },

        checkTime: function(value, $el_0, $el_1) {
            var val_0 = value.toString().charAt(0),
                val_1 = value.toString().charAt(1),
                fig_0_value = $el_0.find('.current').html(),
                fig_1_value = $el_1.find('.current').html();


            if (value >= 10) {
                // if($el_0.hasClass("min0")) {
                //     console.log(val_0,fig_0_value,val_1,fig_1_value);
                // }   
                // Animate only if the figure has changed
                if (fig_0_value !== val_0) this.animateFigure($el_0, val_0);
                if (fig_1_value !== val_1) this.animateFigure($el_1, val_1);
            } else {
                // if($el_0.hasClass("min0")) {
                //     console.log(val_0,fig_0_value,val_1,fig_1_value);
                // } 
                // If we are under 10, replace first figure with 0
                if (fig_0_value !== '0') this.animateFigure($el_0, 0);
                if (fig_1_value !== val_0) this.animateFigure($el_1, val_0);
            }
        }
    };

    // Let's go !
    Countdown.init(total_seconds);

    // 倒计时   end---------------
})();
</script>


</html>
